<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="appTitle"></title>
    <link rel="icon" href="https://img.icons8.com/fluency/96/robot.png" type="image/png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/colors.css">
    <link rel="stylesheet" href="css/spinner.css">
    <script type="importmap">
        {
            "imports": {
                "three": "/external/three@0.160.0/three.js",
                "three/addons/controls/OrbitControls.js": "/external/three@0.160.0/OrbitControl.js"
            }
        }
    </script>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loader-overlay">
        <img src="https://img.icons8.com/fluency/96/robot.png" class="logo-spinner" alt="Loading...">
    </div>

    <h1 data-translate-key="pageTitle"></h1>

    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <div class="theme-toggle-container">
            <div class="theme-toggle" id="theme-toggle-button" data-translate-title-key="themeToggleTitle">
                <svg class="theme-icon-bg sun-icon-bg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18px" height="18px"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.166 18.894a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6.25 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016.25 12zM6.106 7.166a.75.75 0 00-1.06 1.06l1.591 1.59a.75.75 0 001.06-1.061l-1.59-1.591z"></path></svg>
                <svg class="theme-icon-bg moon-icon-bg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18px" height="18px"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69a.75.75 0 01.981.98 10.503 10.503 0 01-4.293 2.126C12.312 17.666 7.344 12.688 7.344 7.5 7.344 4.866 8.167 2.607 9.528 1.718z" clip-rule="evenodd"></path></svg>
                
                <div id="theme-slider" class="theme-slider">
                    <svg class="theme-icon-slider sun-icon-slider" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18px" height="18px"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.166 18.894a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6.25 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016.25 12zM6.106 7.166a.75.75 0 00-1.06 1.06l1.591 1.59a.75.75 0 001.06-1.061l-1.59-1.591z"></path></svg>
                    <svg class="theme-icon-slider moon-icon-slider" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18px" height="18px"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69a.75.75 0 01.981.98 10.503 10.503 0 01-4.293 2.126C12.312 17.666 7.344 12.688 7.344 7.5 7.344 4.866 8.167 2.607 9.528 1.718z" clip-rule="evenodd"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Main Layout Container -->
    <div class="main-layout">

        <!-- Left Column: Visualization -->
        <div class="visualization-column">
            <div class="visualization-section">
                <h3 data-translate-key="visualizationTitle"></h3>
                <div id="robot-visualization-container" class="robot-visualization"></div>
                <div class="visualization-info" data-translate-key="visualizationInfo">
                    Utilisez la souris (Gauche: Rotation, Milieu/Molette: Zoom, Droite: Panoramique) pour explorer. Axes: Rouge=X, Vert=Y, Bleu=Z(Up).
                </div>
            </div>
        </div>

        <!-- Right Column: Controls and Info -->
        <div class="controls-column">
            <div class="tabs">
                <div class="tab active" data-tab="forward" data-translate-key="tabForward"></div>
                <div class="tab" data-tab="inverse" data-translate-key="tabInverse"></div>
            </div>

            <!-- Tab Content: Forward Kinematics -->
            <div class="container tab-content active" id="forward-tab">
                <div class="presets">
                    <h3 data-translate-key="fkTitle"></h3>
                    <div class="preset-buttons">
                        <button class="preset-btn" onclick="window.app.loadPreset('zero')" data-translate-key="presetZero"></button>
                        <button class="preset-btn" onclick="window.app.loadPreset('home')" data-translate-key="presetHome"></button>
                        <button class="preset-btn" onclick="window.app.loadPreset('random')" data-translate-key="presetRandom"></button>
                    </div>
                </div>
                <h3 data-translate-key="jointAnglesTitle"></h3>
                <div class="input-container">
                    <!-- Input groups for angle1 to angle6 -->
                     <div class="input-group"><label for="angle1" data-translate-key="angleLabel1"></label><input type="number" id="angle1" value="0" min="-360" max="360" step="1"></div>
                     <div class="input-group"><label for="angle2" data-translate-key="angleLabel2"></label><input type="number" id="angle2" value="0" min="-360" max="360" step="1"></div>
                     <div class="input-group"><label for="angle3" data-translate-key="angleLabel3"></label><input type="number" id="angle3" value="0" min="-360" max="360" step="1"></div>
                     <div class="input-group"><label for="angle4" data-translate-key="angleLabel4"></label><input type="number" id="angle4" value="0" min="-360" max="360" step="1"></div>
                     <div class="input-group"><label for="angle5" data-translate-key="angleLabel5"></label><input type="number" id="angle5" value="0" min="-360" max="360" step="1"></div>
                     <div class="input-group"><label for="angle6" data-translate-key="angleLabel6"></label><input type="number" id="angle6" value="0" min="-360" max="360" step="1"></div>
                </div>
                <button id="calculate-btn" style="display: flex; align-items: center; justify-content: space-between;">
                    <span data-translate-key="calculateFkButton"></span>
                    <label class="auto-calc-label">
                        <input type="checkbox" id="auto-calc-fk" class="auto-calc-checkbox">
                        <span class="checkbox-label" data-translate-key="autoCalcLabel">Auto</span>
                    </label>
                </button>
                <div class="result-container">
                    <h3 data-translate-key="fkResultsTitle"></h3>
                    <div class="result-grid">
                        <!-- Result boxes for x, y, z, thetaX, thetaY, thetaZ -->
                         <div class="result-box"><div class="result-label" data-translate-key="resultX"></div><div class="result-value" id="x-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="resultY"></div><div class="result-value" id="y-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="resultZ"></div><div class="result-value" id="z-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="resultThetaX"></div><div class="result-value" id="thetaX-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="resultThetaY"></div><div class="result-value" id="thetaY-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="resultThetaZ"></div><div class="result-value" id="thetaZ-result">-</div></div>
                    </div>
                    <!-- Add error rate display -->
                    <div class="error-rate-container">
                        <span class="error-rate-label" data-translate-key="fkErrorRatePrefix">Error rate:</span>
                        <span class="error-rate-value" id="fk-error-rate">0.00</span>
                    </div>
                </div>
                <!-- Visualization section removed from here -->
            </div>

            <!-- Tab Content: Inverse Kinematics -->
            <div class="container tab-content" id="inverse-tab">
                 <h3 data-translate-key="ikTitle"></h3>
                 <div class="preset-buttons">
                    <button class="preset-btn" onclick="window.app.loadPosePreset('zero')" data-translate-key="ikPresetZero"></button>
                    <button class="preset-btn" onclick="window.app.loadPosePreset('home')" data-translate-key="ikPresetHome"></button>
                    <button class="preset-btn" onclick="window.app.loadPosePreset('random')" data-translate-key="ikPresetRandom"></button>
                </div>
                <h3 data-translate-key="jointCartesianTitle"></h3>
                 <div class="input-container">
                     <!-- Input groups for pos-x to orient-z -->
                    <div class="input-group"><label for="pos-x" data-translate-key="ikPositionXLabel"></label><input type="number" id="pos-x" value="0" step="1"></div>
                    <div class="input-group"><label for="pos-y" data-translate-key="ikPositionYLabel"></label><input type="number" id="pos-y" value="0" step="1"></div>
                    <div class="input-group"><label for="pos-z" data-translate-key="ikPositionZLabel"></label><input type="number" id="pos-z" value="0" step="1"></div>
                    <div class="input-group"><label for="orient-x" data-translate-key="ikOrientationXLabel"></label><input type="number" id="orient-x" value="0" step="1"></div>
                    <div class="input-group"><label for="orient-y" data-translate-key="ikOrientationYLabel"></label><input type="number" id="orient-y" value="0" step="1"></div>
                    <div class="input-group"><label for="orient-z" data-translate-key="ikOrientationZLabel"></label><input type="number" id="orient-z" value="0" step="1"></div>
                 </div>
                 <button id="calculate-ik-btn" style="display: flex; align-items: center; justify-content: space-between;">
                    <span data-translate-key="calculateIkButton"></span>
                    <label class="auto-calc-label">
                        <input type="checkbox" id="auto-calc-ik" class="auto-calc-checkbox">
                        <span class="checkbox-label" data-translate-key="autoCalcLabel">Auto</span>
                    </label>
                 </button>
                 <div class="result-container">
                     <h3 data-translate-key="ikResultsTitle"></h3>
                     <div class="result-grid">
                         <!-- Result boxes for ik-angle1 to ik-angle6 -->
                         <div class="result-box"><div class="result-label" data-translate-key="ikAngleResultLabel1"></div><div class="result-value" id="ik-angle1-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="ikAngleResultLabel2"></div><div class="result-value" id="ik-angle2-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="ikAngleResultLabel3"></div><div class="result-value" id="ik-angle3-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="ikAngleResultLabel4"></div><div class="result-value" id="ik-angle4-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="ikAngleResultLabel5"></div><div class="result-value" id="ik-angle5-result">-</div></div>
                         <div class="result-box"><div class="result-label" data-translate-key="ikAngleResultLabel6"></div><div class="result-value" id="ik-angle6-result">-</div></div>
                     </div>
                     <!-- Add error rates display -->
                     <div class="error-rate-container">
                         <span class="error-rate-label" data-translate-key="ikErrorRatePrefix">Error rate:</span>
                         <span class="error-rate-value" id="ik-position-error">0.00</span>
                     </div>
                     <div id="ik-error" class="info-box" style="display: none;"></div>
                 </div>
                 <div class="info-box">
                    <strong data-translate-key="ikImportantInfoTitle"></strong>
                    <span data-translate-key="ikImportantInfoText"></span>
                  </div>
            </div>

            <!-- Robot Info Section -->
            <div class="robot-info">
                <h3 data-translate-key="robotInfoTitle"></h3>
                <p data-translate-key="robotInfoParagraph1"></p>
                <p data-translate-key="robotInfoParagraph2"></p>
                <ul>
                    <li data-translate-key="jointLimit1"></li>
                    <li data-translate-key="jointLimit2"></li>
                    <li data-translate-key="jointLimit3"></li>
                    <li data-translate-key="jointLimit4"></li>
                    <li data-translate-key="jointLimit5"></li>
                    <li data-translate-key="jointLimit6"></li>
                </ul>
            </div>
        </div><!-- End controls-column -->

    </div><!-- End main-layout -->

    <!-- Scripts -->
    <script type="module" src="js/spinner.js"></script>
    <script type="module">
        import { initializeApp } from './js/main.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded. Initializing Kinova Calculator...');
            initializeApp(); // The spinner is now handled inside initializeApp
        });
    </script>

    <!-- Language Toggle Button -->
    <button id="lang-toggle" class="lang-toggle" data-translate-title-key="langToggleTitle" data-translate-key="langToggleText"></button>

</body>
</html>